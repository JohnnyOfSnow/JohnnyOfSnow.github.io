<!DOCTYPE html>
<html>
<head>
	<title>Geo Test.</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
	<style type="text/css">
		*{
			padding: 0;
			margin: 0;
			list-style: none;
		}
		.wrap{
			width: 100%;
		}
		button{
			width: 100%;
			height: 200px;
			text-align: center;
			vertical-align: center;
			font-size: 50px;
		}
		.text{
			font-size: 50px;
		}
	</style>
</head>

<body>
	<div class="wrap">
		<button onclick="geoFindMe()">Show my location</button>
		<button onclick="clearRecord()">Clear</button>
		 <h3>即時預覽Image</h3>
	    <form name="form0" id="form0" >
	        <input type="file" name="file0" id="file0" multiple="multiple" /><br>
	        <img src="" id="img0" >
	    </form>
		<div id="out" class="text"></div>
	</div>
</body>
</html>
<script>
	var recordStr = "";
	var output = document.getElementById("out");

	function geoFindMe(){
		

		if (!navigator.geolocation){
			output.innerHTML = "<p>Geolocation is not supported by your browser</p>";
		 	return;
  		}
  		function success(position) {
		    var latitude  = position.coords.latitude;
		    var longitude = position.coords.longitude;
		    addRecord(latitude, longitude);
		   
		  };

		  function error() {
		    output.innerHTML = "Unable to retrieve your location";
		  };

		  output.innerHTML = "<p>Locating…</p>";

		  navigator.geolocation.getCurrentPosition(success, error);
	}

	function addRecord(latitude, longitude){
		 recordStr = recordStr + '<p>您的位置在；<br>緯度: ' + latitude + '° <br>經度: ' + longitude + '°</p><br>';
		 output.innerHTML = recordStr;
	}

	function clearRecord(){
		recordStr = "";
		output.innerHTML = recordStr;
	}

	 /**
     * 使用HTML5 File API, 來即時預覽image
     */
    $("#file0").change(function(){
        var objUrl = getObjectURL(this.files[0]) ;
        console.log("objUrl = "+objUrl) ;
        if (objUrl) {
            $("#img0").attr("src", objUrl) ;
        }
    }) ;
    
    /**
     * 建立一個可存取到該file的url
     * PS: 瀏覽器必須支援HTML5 File API
     */
    function getObjectURL(file) {
        var url = null ; 
        if (window.createObjectURL!=undefined) { // basic
            url = window.createObjectURL(file) ;
        } else if (window.URL!=undefined) { // mozilla(firefox)
            url = window.URL.createObjectURL(file) ;
        } else if (window.webkitURL!=undefined) { // webkit or chrome
            url = window.webkitURL.createObjectURL(file) ;
        }
        return url ;
        console.log( url )
    }
</script>